# 📊 数据管理中心使用指南

## 功能概述

数据管理中心是一个统一的数据分析和导出平台，整合了所有报备记录和派单记录的统计、分析、验证和导出功能。

## 快速开始

### 1. 启动数据管理中心
```
/datacenter
```

执行此命令后，会显示主面板，包括：
- **数据概览** - 报备系统和派单系统的基础统计
- **数据质量** - 数据完整性检查结果

### 2. 主面板功能按钮

| 按钮 | 功能 | 说明 |
|------|------|------|
| 📥 导出 Excel | 导出Excel文件 | 生成包含报备记录和派单记录两个Sheet的Excel文件 |
| 📊 查看排行 | 查看排行榜 | 显示派单员、陪玩员、老板的Top 10排行 |
| 🔍 数据检查 | 检查数据质量 | 验证数据完整性，查找缺号、缺信息等问题 |
| 📅 时间筛选 | 按时间范围筛选 | 快速选择时间范围，查看该范围内的统计数据 |
| ✈️ 发送到飞机 | 导出到Telegram | 将Excel文件导出到指定的Telegram频道 |
| 🔄 刷新 | 刷新面板 | 重新加载所有数据，显示最新统计结果 |

## 功能详解

### 📈 数据概览
显示以下统计信息：

**报备系统 (Reports)**
- 总计: 报备记录总数
- 金额: 所有报备金额总和
- 时长: 所有报备的小时数总和
- 缺号: 缺少订单号的记录数

**派单系统 (Dispatches)**
- 总计: 派单记录总数
- 金额: 所有派单价格总和
- 时长: 所有派单的小时数总和
- 缺号: 缺少订单号的记录数

**总体统计**
- 总金额: 所有系统的总金额
- 总时长: 所有系统的总时长

### 📊 查看排行
显示Top 10排行榜：

**派单员排行 (Assigners)**
- 按派单金额排序
- 显示派单数量和总金额

**陪玩员排行 (Players)**
- 按总收入排序
- 包括报备和派单的总金额

**老板排行 (Bosses)**
- 仅统计报备记录
- 按金额排序
- 显示报备数量和总金额

### 🔍 数据检查
执行全面的数据质量检查，包括：

**问题项 ⚠️**
- 缺少订单号的记录
- 重复的订单号
- 其他严重数据问题

**提醒项 📌**
- 缺少老板信息
- 缺少陪玩员信息
- 金额为零的记录

### 📅 时间筛选
快速时间范围选择：

| 选项 | 范围 | 用途 |
|------|------|------|
| 今天 | 当天 | 查看每日统计 |
| 最近7天 | 过去7天 | 周度统计和分析 |
| 最近30天 | 过去30天 | 月度统计和分析 |
| 全部数据 | 全历史 | 全面统计和对比 |

### 📥 导出 Excel
生成Excel文件，包含两个Sheet：

**Sheet 1: 报备记录**
| 列 | 说明 |
|---|------|
| 序号 | 行号 |
| 类型 | 记录类型（固定为"报备"） |
| 报备类型 | 新单/续单/赠送 |
| 老板 | 老板名称 |
| 陪陪 | 陪玩员名称 |
| 单子类型 | 游戏类型 |
| 时长 | 游戏时长 |
| 金额 | 报备金额 |
| 单号 | 订单号（自动生成） |
| 报备时间 | 报备提交时间 |

**Sheet 2: 派单记录**
| 列 | 说明 |
|---|------|
| 序号 | 行号 |
| 单号 | 订单号 |
| 派单员 | 派单人名称 |
| 陪玩员 | 陪玩员名称 |
| 游戏 | 游戏名称 |
| 时长 | 游戏时长 |
| 价格 | 派单价格 |
| 派单时间 | 派单提交时间 |

### ✈️ 发送到Telegram
将Excel文件导出到配置的Telegram频道，方便远程查看和分享。

## 数据来源

所有数据均直接读取 `orders.json` 文件，确保数据的最新性和准确性。

## 数据分类规则

### 报备记录 vs 派单记录
- **报备记录**: `type === "report"` 的记录
- **派单记录**: `type !== "report"` 的记录

### 报备类型分类
根据 `source` 字段判断：
- `reportForm` → 新单
- `renewReportForm` → 续单
- `giftReportForm` → 赠送

## 常见问题

### Q: 导出的Excel中显示"未填写"是什么意思？
A: 表示该记录的订单号还未分配或添加。系统会自动从 `orders.json` 中读取最新的订单号。

### Q: 排行榜是否实时更新？
A: 是的，每次点击"查看排行"或刷新时，数据都会从最新的 `orders.json` 中重新计算。

### Q: 时间筛选后可以导出吗？
A: 可以。在时间筛选结果页面有"导出 Excel"按钮，可导出选定时间范围内的数据。

### Q: 如何联系客服解决数据问题？
A: 通过"数据检查"功能查看具体问题，或联系管理员手动核查 `orders.json` 文件。

## 系统架构

### 核心模块

**statistics.js** - 数据统计引擎
```javascript
// 加载数据
loadOrdersData()              // 从orders.json读取数据

// 统计计算
calculateSummary()            // 计算总体统计
getAssignerRanking()          // 派单员排行
getPlayerRanking()            // 陪玩员排行
getBossRanking()              // 老板排行

// 数据验证
performDataQualityCheck()     // 数据质量检查
filterByDateRange()           // 日期范围筛选

// 格式化输出
formatSummary()               // 格式化为Discord embed
```

### 权限要求
- 执行 `/datacenter` 命令需要**管理员权限**

## 更新日志

### v1.0 (当前版本)
- ✅ 数据管理中心主面板
- ✅ 数据概览和质量检查
- ✅ 排行榜显示
- ✅ Excel导出（两个Sheet）
- ✅ Telegram导出
- ✅ 时间范围筛选
- ✅ 实时数据刷新

## 联系支持

如有任何问题或建议，请联系技术团队。

---

**最后更新**: 2024年 | 数据管理中心 v1.0
