# 📊 /db 数据库管理中心使用指南

## 🎯 概述

`/db` 是一个**综合数据库管理命令**，提供了一个统一的控制面板，可以快速访问所有数据库相关功能。

---

## 📋 功能概览

### 🎛️ 主菜单面板

执行 `/db` 命令后，你会看到一个包含以下功能的菜单：

#### 第一行按钮
| 按钮 | 功能 | 说明 |
|------|------|------|
| 📊 数据库信息 | db_info | 查看详细的数据库统计信息 |
| ✏️ 编辑数据 | db_edit | 查看和编辑订单数据 |
| ⚙️ 数据管理 | db_manager | 数据库管理选项和操作 |

#### 第二行按钮
| 按钮 | 功能 | 说明 |
|------|------|------|
| 📥 导出 Excel | db_export_excel | 导出所有订单数据为 Excel 文件 |
| 💾 导出 JSON | db_export_json | 导出所有订单数据为 JSON 文件 |
| 🔄 刷新数据 | db_refresh | 重新加载数据库信息（更新统计） |

---

## 🚀 使用示例

### 示例 1：查看数据库概览

```
用户: /db
机器人: 显示主菜单
  ┌─ 📊 数据库管理中心 ─┐
  │ 选择下方功能按钮进行相应操作～
  │
  │ 📈 数据库统计
  │ 总订单数: 32
  │ 总收入: RM 1569.00
  │ 记录总数: 70
  │ 最后更新: 2026-01-02
  └──────────────────┘

[📊数据库信息] [✏️编辑数据] [⚙️数据管理]
[📥导出Excel] [💾导出JSON] [🔄刷新数据]
```

### 示例 2：查看详细信息

```
用户: 点击 [📊 数据库信息] 按钮
机器人: 显示详细统计
  📊 数据库详细信息
  
  📈 统计数据
  总订单数: 32
  总收入: RM 1569.00
  平均单价: RM 49.03
  
  💾 数据库状态
  记录总数: 70
  数据库大小: 24.62 KB
  最后更新: 2026-01-02
  文件位置: ./data.db
```

### 示例 3：导出数据

```
用户: 点击 [📥 导出 Excel] 按钮
机器人: ✅ 已导出 70 条订单记录
        [订单数据_2026-01-02.xlsx] 下载

用户: 点击 [💾 导出 JSON] 按钮
机器人: ✅ 已导出 70 条订单记录
        [订单数据_2026-01-02.json] 下载
```

### 示例 4：编辑数据

```
用户: 点击 [✏️ 编辑数据] 按钮
机器人: 显示最近可编辑的订单列表
  ✏️ 编辑数据
  
  【可编辑的最近订单】
  
  [1] ID:70
      玩家: 豆豆
      金额: RM 30
  
  [2] ID:69
      玩家: 小美
      金额: RM 50
  
  如何编辑:
  • 使用 node db-edit.js 进行详细编辑
  • 或在 Discord 中要求管理员协助编辑
  • 支持修改: 玩家名、金额、订单类型等
```

### 示例 5：刷新数据

```
用户: 点击 [🔄 刷新数据] 按钮
机器人: 重新加载所有数据库信息
        【面板自动更新，显示最新统计数据】
```

---

## 📊 导出数据说明

### Excel 导出格式

导出的 Excel 文件包含以下列：

```
序号 | ID  | 玩家  | 老板  | 类型   | 时长 | 金额 | 单号 | 来源      | 日期
-----|-----|-------|-------|--------|------|------|------|-----------|--------
1    | 70  | 豆豆  | Jerry | 永劫   | 1h   | 30   | 001  | reportForm| 2025-...
2    | 69  | 小美  | 张三  | 原神   | 2h   | 50   | 002  | reportForm| 2025-...
```

### JSON 导出格式

导出的 JSON 文件包含完整的订单数据结构：

```json
[
  {
    "id": 70,
    "player": "豆豆",
    "boss": "Jerry",
    "orderType": "永劫",
    "duration": "1h",
    "amount": 30,
    "orderNo": "001",
    "source": "reportForm",
    "date": "2025-..."
  },
  ...
]
```

---

## 🔐 权限说明

- **需要权限**: 管理员权限或管理员角色
- **可见性**: 仅管理员可看到此命令
- **用途**: 保护数据库访问安全

---

## 💡 使用建议

### 🌅 每日检查流程
```
1. 执行 /db
2. 点击 📊 查看数据库信息
3. 检查新增订单数和收入
4. 点击 🔄 刷新数据（如有新单）
```

### 📦 周期数据备份
```
1. 执行 /db
2. 点击 📥 导出 Excel（作为主要备份）
3. 点击 💾 导出 JSON（作为备用备份）
4. 保存文件到安全位置
```

### ✏️ 数据修正流程
```
1. 执行 /db
2. 点击 ✏️ 编辑数据（查看最近订单）
3. 使用 node db-edit.js（进行详细编辑）
4. 执行 /db，点击 🔄 刷新数据（确认修改）
```

### 🔍 数据查询流程
```
1. 执行 /db
2. 点击 📊 数据库信息（查看统计概览）
3. 点击 💾 导出 JSON（获取完整数据进行分析）
4. 使用 Excel 或其他工具分析
```

---

## ⚙️ 按钮详解

### 📊 数据库信息 (db_info)
**功能**: 显示数据库的详细统计信息

**包含内容**:
- 总订单数
- 总收入
- 平均单价
- 记录总数
- 数据库大小
- 最后更新时间
- 数据库文件位置

**何时使用**: 需要快速了解数据库状态时

---

### ✏️ 编辑数据 (db_edit)
**功能**: 查看最近的订单，了解如何编辑数据

**包含内容**:
- 最近 5 条订单列表
- 编辑方法说明
- 支持修改的字段

**何时使用**: 需要修改某条订单的数据时

---

### ⚙️ 数据管理 (db_manager)
**功能**: 查看数据库管理选项和操作建议

**包含内容**:
- 现有订单统计
- 可用的管理操作
- 数据库维护建议

**何时使用**: 需要了解如何进行数据库维护时

---

### 📥 导出 Excel (db_export_excel)
**功能**: 导出所有订单数据为 Excel 文件

**输出**:
- 文件名: `订单数据_YYYY-MM-DD.xlsx`
- 包含所有 70 条记录
- 格式: 标准 Excel 工作表

**何时使用**: 需要用 Excel 分析数据或制作报表时

---

### 💾 导出 JSON (db_export_json)
**功能**: 导出所有订单数据为 JSON 文件

**输出**:
- 文件名: `订单数据_YYYY-MM-DD.json`
- 包含所有 70 条记录
- 格式: 标准 JSON 结构

**何时使用**: 需要进行数据备份或编程处理时

---

### 🔄 刷新数据 (db_refresh)
**功能**: 重新加载数据库信息并更新显示

**效果**:
- 重新查询数据库
- 更新统计信息
- 刷新所有按钮状态

**何时使用**: 数据已被修改或需要最新数据时

---

## 📝 常见任务流程

### 任务 1: 检查今日收入

```
/db
  → 查看 "📈 数据库统计" 面板
  → 记录 "总收入: RM XXXX"
```

### 任务 2: 导出本周数据

```
/db
  → 点击 [📥 导出 Excel]
  → 下载文件
  → 用 Excel 打开并分析
```

### 任务 3: 修正某条订单

```
/db
  → 点击 [✏️ 编辑数据]
  → 查看要修改的订单 ID
  → 运行 node db-edit.js
  → 点击 [🔄 刷新数据] 确认
```

### 任务 4: 数据库备份

```
/db
  → 点击 [📥 导出 Excel]
  → 保存文件到云盘或本地
  → 点击 [💾 导出 JSON]
  → 保存文件到备份位置
```

---

## 🆘 常见问题

**Q: 为什么看不到 /db 命令？**
A: 需要管理员权限。检查你的角色是否设置为管理员。

**Q: 导出的文件在哪里？**
A: 文件会在 Discord 中直接下载，默认保存到 "下载" 文件夹。

**Q: 如何修改已导出的数据？**
A: 导出文件仅供查看和备份。如需修改，请使用 `node db-edit.js` 或点击 ✏️ 编辑数据。

**Q: 刷新数据会删除什么吗？**
A: 不会。刷新仅重新读取数据库，不会修改任何数据。

**Q: Excel 和 JSON 哪个更好？**
A: 
- **Excel**: 适合看报表、做统计分析
- **JSON**: 适合备份、编程处理、数据传输

**Q: 多久导出一次数据比较好？**
A: 建议每周导出一次作为备份。如果数据很重要，可以每天导出。

---

## 📋 快速命令参考

```
/db                    # 打开数据库管理中心

# 按钮快捷列表
📊 数据库信息          # 查看详细统计
✏️ 编辑数据            # 查看编辑方法
⚙️ 数据管理            # 管理选项
📥 导出 Excel          # 导出为 Excel
💾 导出 JSON           # 导出为 JSON
🔄 刷新数据            # 重新加载数据
```

---

## 🔧 相关命令行工具

| 工具 | 命令 | 功能 |
|------|------|------|
| db-info.js | `node db-info.js` | CLI 版数据库信息 |
| db-edit.js | `node db-edit.js` | CLI 版编辑工具 |
| db-manager.js | `node db-manager.js` | CLI 版管理工具 |
| db.ps1 | `.\db.ps1` | PowerShell 包装器 |

---

## 📅 创建日期
2026-01-02

## ✅ 状态
✨ **已完全集成到 Discord**

